{% extends "page.html" %}
{% load i18n static %}

{% block content %}
<div class="flex items-center justify-center min-h-screen bg-gray-50">
    <div class="w-full max-w-lg p-8 bg-white shadow-2xl rounded-xl">
        <h2 class="text-3xl font-semibold text-center text-gray-800 mb-8">
            {% blocktrans %}Create a New Event{% endblocktrans %}
        </h2>

        <form class="space-y-6" method="POST" action="">
            {% csrf_token %}

            <!-- Event Name -->
            <div>
                <label for="name" class="block text-sm font-medium text-gray-700">
                    {% blocktrans %}Event Name{% endblocktrans %}
                </label>
                <div class="mt-2">
                    <input type="text" id="name" name="name" required
                        class="block w-full rounded-lg border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
            </div>

            <!-- Description -->
            <div>
                <label for="description" class="block text-sm font-medium text-gray-700">
                    {% blocktrans %}Description{% endblocktrans %}
                </label>
                <div class="mt-2">
                    <textarea id="description" name="description" rows="4"
                        class="block w-full rounded-lg border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
            </div>

            <!-- Schedule Options -->
            <div id="schedule-options" class="space-y-4">
                <label class="block text-sm font-medium text-gray-700 mt-4">
                    {% blocktrans %}Schedule Options{% endblocktrans %}
                </label>
                <div class="flex space-x-4 mt-2 mb-4">
                    <input type="text" id="initial-datetime-picker" name="schedule_options[]"
                        class="datetime-picker block w-full rounded-lg border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        placeholder="YYYY-MM-DD">
                </div>
                <button type="button" onclick="addDateField()"
                    class="text-sm font-medium text-indigo-600 hover:text-indigo-500">
                    {% blocktrans %}+ Add Another Date{% endblocktrans %}
                </button>
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit"
                    class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    {% blocktrans %}Submit{% endblocktrans %}
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Include flatpickr library locally -->
<link rel="stylesheet" href="{% static 'flatpicker/flatpickr.min.css' %}">
<script src="{% static 'flatpicker/flatpickr.min.js' %}"></script>

<style>
    .flatpickr-day.selected,
    .flatpickr-day.startRange,
    .flatpickr-day.endRange,
    .flatpickr-day.selected:hover,
    .flatpickr-day.startRange:hover,
    .flatpickr-day.endRange:hover {
        background-color: #6366f1;
        border-color: #6366f1;
        color: white;
    }

    .flatpickr-day.today {
        border-color: #6366f1;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const userLang = navigator.language || navigator.userLanguage;
        const locale = userLang.split('-')[0];
        const localesUsing24Hour = ['nl', 'fr', 'de', 'es', 'it'];

        // Initialize the initial datetime-picker field
        flatpickr(document.getElementById('initial-datetime-picker'), {
            enableTime: true,
            time_24hr: localesUsing24Hour.includes(locale),
            locale: locale || 'en',
        });

        // Initialize all other existing datetime-picker fields
        document.querySelectorAll('.datetime-picker').forEach(field => {
            flatpickr(field, {
                enableTime: true,
                time_24hr: localesUsing24Hour.includes(locale),
                locale: locale || 'en',
            });
        });

        function addDateField() {
            const scheduleOptions = document.getElementById('schedule-options');
            const newField = document.createElement('div');
            newField.className = 'flex space-x-4 mt-2 mb-4';
            newField.innerHTML = `
            <input type="text" name="schedule_datetime[]"
                class="datetime-picker block w-full rounded-lg border-gray-300 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                placeholder="YYYY-MM-DD">
        `;
            scheduleOptions.insertBefore(newField, scheduleOptions.lastElementChild);

            // Reinitialize Flatpickr for the new input field
            flatpickr(newField.querySelector('.datetime-picker'), {
                enableTime: true,
                time_24hr: localesUsing24Hour.includes(locale),
                locale: locale || 'en',
            });
        }

        // Make addDateField function available globally
        window.addDateField = addDateField;
    });
</script>
{% endblock %}
